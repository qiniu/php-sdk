language: php

php:
  - 5.4
  - 5.5
  - 5.6
  - 7.0

dist: trusty
os: linux

before_script:
  - export QINIU_TEST_ENV="travis"
  - travis_retry composer self-update
  - travis_retry composer install --no-interaction --prefer-source --dev

script:
  - ./vendor/bin/phpcs --standard=PSR2 src
  - ./vendor/bin/phpcs --standard=PSR2 examples
  - ./vendor/bin/phpcs --standard=PSR2 tests
  - ./vendor/bin/phpunit --coverage-clover=coverage.xml

after_script:
  - wget https://scrutinizer-ci.com/ocular.phar
  - php ocular.phar code-coverage:upload --format=php-clover coverage.clover

env:
  global:
  - QINIU_ACCESS_KEY=vHg2e7nOh7Jsucv2Azr5FH6omPgX22zoJRWa0FN5
  - secure: glznC1fAiLTyCb03q0o3zpYQkbjiV0uTHrGbgCWIw0kzp5uLHALgRbQkvSG1KzY/pT2QxcLNPp1N9JdcvQPZ0X1WYBrkgtbB3LvNQYvfNlGgRiSlQ9VMsEvcxsCp12riyUBysYwjJ3VX9AhsxB+lQmLxnvdK036/KMBHnvZmFevp4jI9ucqasKTFFgLUB31GXacNPAV9eOaUMDw1GZywuSqFggvFPGat6C1Y+SBt8oj+ubgoozNVAyAND8Vqv9DNnn54G2mvJScBACjSmlqd6hVuOvvSbArAC1JwqnxAvXUycSR5OtPJRrvS5glRrrpTJsqsPg8T+it3oNgZ06LrXpAkv4rwVRzGWOVLDbpIHvfGWgbCotgoWWw2HLbAyHjT6g1XDydYJbyfoyx0h0dfYGY20hHecC4e+tEVHRMxe+R/u6iSV9HU2yWvWv6IVNeVI64slQHR7tGAvu3zD89xZz1Aj24PUlbGeb9syKzg3AnFqrxH+fuJE5jjgT/bygvZ60bDVIRKEHMD49phP9boVkbX4Ew1Ry0zGpXGdcBf/NjNWguy+2d1NiMhLieXh9Wu0nr7ShjQhOfazOwwHuGsDf4jXlMW+q3aHCDdS0/aLcaHXUI1twE0refk7DDmuUcMmqDr3FYwiDVdw4InDglgSOENzEg30WUL5S57OYKFalo=

after_success:
  - bash <(curl -s https://codecov.io/bash)
language: php

php:
  - 5.4
  - 5.5
  - 5.6
  - 7.0

dist: trusty
os: linux

before_script:
  - export QINIU_TEST_ENV="travis"
  - travis_retry composer self-update
  - travis_retry composer install --no-interaction --prefer-source --dev

script:
  - ./vendor/bin/phpcs --standard=PSR2 src
  - ./vendor/bin/phpcs --standard=PSR2 examples
  - ./vendor/bin/phpcs --standard=PSR2 tests
  - ./vendor/bin/phpunit --coverage-clover=coverage.xml

after_script:
  - wget https://scrutinizer-ci.com/ocular.phar
  - php ocular.phar code-coverage:upload --format=php-clover coverage.clover

env:
  global:
    - secure: "uIm1wYTfRi046vv6+hs7lPrqgWD/oVehOA8gqxG1ITU507zkiRpIq6Fzy+/wpUd6dTVp62mJuYMY0xqLPTTbpu97h3WrAuFWY3jyQsmOBMMZBFLqdbWg9ZPDna2e9aTcrW0aBTWT/rQTiz070FF8wLevsQ7LFxlTrBBqcRB7bMg1GL1OkqsAeL1uWJM9c2W0ex1ATcDDH5KBg6eX1eNsTNxIXxPlBv8Ls5rnfTVku9+kg7geF723FNTz+xcm3vKGgXUg4fx9QGrwxWrw7QEQSagEMoiVYLVVlsxltyYevwn+yTHnRvk7lTpWu5RXFZAzc7DFdK3Dg+kdAP8Ls/H/7pWjxdg/jQr6oo94pXxFdEvtfnnWzFnhHzd9LkNhZpWZwlL3DcNUXwPHvLTSoxRgRdJ25TSJnF0G9k6uuq4R89kaSA2cHFS26g5Amm8t+a/nhw1p7q5ZdTUxWapYET2v5TIw9ED5Pn8uS31Ge+Q6vFYVWnBylPz5a7WTJzO1xWN8IcUfsuh5gzqTh7p+rFJ30MaWbpFILMhPgp93OMJW4w7iOTewG99LLC4TG/wThr5riT740f/XPfvI4JstORNUabqXobPkMCt292DDSWnsg87/GgCoOf6GzKOYgsjotLtm6JnY/b/LTkk9dFIUOTih5vyUP4OAX5SGAvbS/MJbTaQ="
    - QINIU_ACCESS_KEY=vHg2e7nOh7Jsucv2Azr5FH6omPgX22zoJRWa0FN5

after_success:
  - bash <(curl -s https://codecov.io/bash)